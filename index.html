<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TV 直播站</title>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <style>
    body {
      margin: 0;
      font-family: "Microsoft YaHei", sans-serif;
      background: #f4f4f4;
      color: #333;
      text-align: center;
    }

    h1 {
      background-color: #4CAF50;
      color: white;
      padding: 1rem;
      margin: 0;
    }

    #currentChannel {
      margin: 1rem 0 0.5rem;
      color: #4CAF50;
      font-size: 1.2rem;
    }

    video {
      width: 100%;
      max-width: 720px;
      height: auto;
      margin: 0 auto;
      border: 4px solid #4CAF50;
      border-radius: 10px;
      box-shadow: 0 0 10px #ccc;
    }

    input[type="text"] {
      width: 80%;
      max-width: 500px;
      padding: 0.5rem;
      margin: 1rem auto;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 1rem;
    }

    ul {
      list-style: none;
      padding: 0;
    }

    li {
      padding: 10px;
      margin: 4px auto;
      max-width: 600px;
      background-color: white;
      border: 1px solid #ddd;
      border-radius: 6px;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    li:hover {
      background-color: #e6f4ea;
    }

    .group h3 {
      background-color: #e0e0e0;
      padding: 10px;
      margin: 10px 0 0;
      cursor: pointer;
      font-size: 1.1rem;
    }

    @media (max-width: 768px) {
      video {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <h1>📺 TV 直播站</h1>
  <h2 id="currentChannel">当前未播放任何频道</h2>
  <video id="player" controls autoplay></video>
  <input type="text" id="search" placeholder="🔍 搜索频道..." onkeyup="filterChannels()" />

  <!-- 频道分组 -->
  <div class="group">
    <h3 onclick="toggleGroup(this)">📁 体育频道</h3>
    <ul>
      <li onclick="play('https://example.com/cctv5.m3u8', 'CCTV-5 体育')">CCTV-5 体育</li>
      <li onclick="play('https://example.com/espn.m3u8', 'ESPN')">ESPN</li>
    </ul>
  </div>

  <div class="group">
    <h3 onclick="toggleGroup(this)">📁 卫视频道</h3>
    <ul>
      <li onclick="play('https://example.com/hunan.m3u8', '湖南卫视')">湖南卫视</li>
      <li onclick="play('https://example.com/beijing.m3u8', '北京卫视')">北京卫视</li>
    </ul>
  </div>

  <script>
    function play(url, name = '') {
      const video = document.getElementById('player');
      if (Hls.isSupported()) {
        const hls = new Hls();
        hls.loadSource(url);
        hls.attachMedia(video);
        hls.on(Hls.Events.MANIFEST_PARSED, function () {
          video.play();
        });
      } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
        video.src = url;
        video.addEventListener('loadedmetadata', function () {
          video.play();
        });
      } else {
        alert('你的浏览器不支持播放该直播源。');
      }
      // 更新标题 & 本地记忆
      document.getElementById('currentChannel').innerText = name ? `正在播放：${name} ⏳` : '当前未播放任何频道';
      localStorage.setItem('lastPlayedUrl', url);
      localStorage.setItem('lastPlayedName', name);
    }

    function toggleGroup(title) {
      const ul = title.nextElementSibling;
      ul.style.display = ul.style.display === "none" ? "block" : "none";
    }

    function filterChannels() {
      const input = document.getElementById('search').value.toLowerCase();
      const groups = document.querySelectorAll('.group');
      groups.forEach(group => {
        const lis = group.querySelectorAll('li');
        let visible = false;
        lis.forEach(li => {
          if (li.innerText.toLowerCase().includes(input)) {
            li.style.display = '';
            visible = true;
          } else {
            li.style.display = 'none';
          }
        });
        group.style.display = visible ? '' : 'none';
      });
    }

    window.onload = function () {
      const lastUrl = localStorage.getItem('lastPlayedUrl');
      const lastName = localStorage.getItem('lastPlayedName');
      if (lastUrl) {
        play(lastUrl, lastName);
      }
    }
  </script>
</body>
</html>
